{
    "contents" : "#--------------------------------------------------------\n#  Factor Engineering for kaggle-bike-sharing\n#  Taposh Roy\n#  @taposh_dr\n#--------------------------------------------------------\n\nsetwd(\"/Users/taposh/workspace/kaggle/bikeshare/\")\nsource(\"utils.R\")\n\n#Seperating out the outputs from training\nactual<-c()\ncountresult <-c()\ncausal<-c()\nregistered<-c()\ncountresult<-cbind(\"count\"=countresult,bike[,\"count\"])\nactual<-cbind(\"count\"=actual,bike[,\"count\"])\ncausal<-cbind(causal,bike[,\"casual\"])\nregistered<-cbind(registered,bike[,\"registered\"])\n\ncausal<-log(causal)\ncausal[causal[,1]<0,1]<-0\nregistered<-log(registered)\nregistered[registered[,1]<0,1]<-0\nactual<-log(actual)\n#actual[actual[,1]<0,1]<-0\n\n###################\n###Result Analysis\n##################\nresult.train<-c()\nresult.train <- data.frame(countresult)\nhead(result.train)\ncolnames(result.train) <- c(\"actual\")\nresult.stat<-c()\nresult.test<-c()\n\n\n###########################\n#Dealing with datetimes\n###########################\n\ntraintimes<-paste(bike[,\"datetime\"])\ntimes<-paste(test[,\"datetime\"])\n\n#4 variables - hour,day, month and year\nbike<-cbind(bike,\"hour\"=format(as.POSIXct(bike[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%H\"),\n            \"day\"=format(as.POSIXct(bike[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%d\"),\n            \"month\"=format(as.POSIXct(bike[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%m\"),\n            \"year\"=format(as.POSIXct(bike[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%Y\")\n)\nbike[,c(\"hour\",\"day\",\"month\",\"year\")]<-as.matrix(bike[,c(\"hour\",\"day\",\"month\",\"year\")])\n\nfor(i in 1:nrow(bike)){\n  for(j in c(\"hour\",\"day\",\"month\",\"year\")){\n    if(is.na(bike[i,j])){\n      bike[i,j]<-mean(as.numeric(bike[i-1,j]),as.numeric(bike[i+1,j]))}\n  }}\n\ntest<-cbind(test,\"hour\"=format(as.POSIXct(test[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%H\"),\n            \"day\"=format(as.POSIXct(test[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%d\"),\n            \"month\"=format(as.POSIXct(test[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%m\"),\n            \"year\"=format(as.POSIXct(test[,\"datetime\"], format=\"%Y-%m-%d %H:%M\"), format=\"%Y\")\n)\ntest[,c(\"hour\",\"day\",\"month\",\"year\")]<-as.matrix(test[,c(\"hour\",\"day\",\"month\",\"year\")])\n\n######################\n# Actual biketime\n#####################\nSTART<-ISOdate(min(bike[,\"year\"]),min(bike[,\"month\"]),min(bike[,\"day\"]),min(bike[,\"hour\"]))\nbikeTIME<-c()\ntestTIME<-c()\nfor(i in 1:nrow(bike)){\n  bikeTIME<-rbind(bikeTIME,difftime(ISOdate(bike[i,\"year\"],bike[i,\"month\"],bike[i,\"day\"],bike[i,\"hour\"]),START,units=\"hours\"))}\nfor(i in 1:nrow(test)){\n  testTIME<-rbind(testTIME, difftime(ISOdate(test[i,\"year\"],test[i,\"month\"],test[i,\"day\"],test[i,\"hour\"]),START,units=\"hours\"))}\n\nhead(bike,4)\n\n#Weather : removing 4\n#bike$weather[bike$weather == 4] <- 3\n#test$weather[test$weather == 4] <- 3\n\n#http://www.r-bloggers.com/from-continuous-to-categorical/\n#bike$tempfactor<-cut(as.numeric(bike$temp), c(0,5,10,15,20,25,34,41))\n#test$tempfactor<-cut(as.numeric(test$temp), c(0,5,10,15,20,25,34,41))\n\n#bike$tempfactor[bike$tempfactor == \"NA\"] <- \"0\"\n\n\n################################\n#Note: move this to utils.R\n################################\ndayof<-function(X){\n  month<-as.matrix(as.numeric(X[,\"month\"]))\n  month[month==1]<-13\n  month[month==2]<-14\n  day<-as.matrix(as.numeric(X[,\"day\"]))\n  year<-cbind(as.numeric(X[,\"year\"]),as.numeric(X[,\"month\"]))\n  for(i in 1:nrow(year)){\n    if((year[i,2]<=2)==TRUE){year[i,1]<-year[i,1]-1}\n  }\n  year<-as.matrix(year[,1])\n  y<-year %% 2000\n  c<-year - y\n  c<-c/100\n  DAY<-(day+floor(13*(month+1)/5)+y+floor(y/4)+floor(c/4)-c) %% 7\n  return(DAY)}\n\nbike<-cbind(bike,\"dayof\"=dayof(bike))\ntest<-cbind(test,\"dayof\"=dayof(test))\n\ntest<-test[,colnames(test)!=\"datetime\"]\ntest<-test[,colnames(test)!=\"day\"]\ntest<-test[,colnames(test)!=\"year\"]\nbike<-bike[,colnames(test)]\n\n######################\n## Matrix Interactions\n######################\nbike1<- model.matrix(~(bikeTIME+bike[,\"season\"]+bike[,\"weather\"]+bike[,\"temp\"]+bike[,\"atemp\"]+bike[,\"humidity\"])^6,bike)\n\ntest1<- model.matrix(~(testTIME+test[,\"season\"]+test[,\"weather\"]+test[,\"temp\"]+test[,\"atemp\"]+test[,\"humidity\"])^6,test)\n\ncolnames(bike)\ncolnames(test)\n\n\nbike <- cbind(bike,bike1)\ntest <- cbind(test,test1)\n###########################\n# Other Factors\n###########################\nbike<-cbind(bike,\n            btsaweather= bikeTIME*bike[,\"season\"]*bike[,\"weather\"],\n            btsaweathertemp= bikeTIME*bike[,\"season\"]*bike[,\"weather\"]*bike[,\"temp\"]\n)\n\ntest<-cbind(test,\n            btsaweather= testTIME*test[,\"season\"]*test[,\"weather\"],\n            btsaweathertemp= testTIME*test[,\"season\"]*test[,\"weather\"]*test[,\"temp\"]\n)\n\nbike<-cbind(bike,\n            temp2=(bike[,\"temp\"])^2,\n            atemp2=(bike[,\"atemp\"])^2,\n            humid2=(bike[,\"humidity\"])^2,\n            windspeed2=(bike[,\"windspeed\"])^2,\n            temp3=(bike[,\"temp\"])^3,\n            atemp3=(bike[,\"atemp\"])^3,\n            humid3=(bike[,\"humidity\"])^3,\n            windspeed3=(bike[,\"windspeed\"])^3)\n\ntest<-cbind(test,\n            temp2=test[,\"temp\"]^2,\n            atemp2=test[,\"atemp\"]^2,\n            humid2=test[,\"humidity\"]^2,\n            windspeed2=(test[,\"windspeed\"])^2,\n            temp3=(test[,\"temp\"])^3,\n            atemp3=(test[,\"atemp\"])^3,\n            humid3=(test[,\"humidity\"])^3,\n            windspeed3=(test[,\"windspeed\"])^3)\n\ntest<-cbind(test,\n            t1=sin(4*pi*testTIME/(24)),\n            t2=sin(2*pi*testTIME/(1000))*cos(2*pi*testTIME/(24)),\n            t3=cos(4*pi*testTIME/(24)),\n            #t4=cos(4*pi*testTIME/(1000)),\n            t5=tanh(2*pi*testTIME/(24)),\n            #tanh(2*pi*testTIME/(1000)),\n            t6=tanh(2*pi*testTIME/(365*24)),\n            #t7=tanh(4*pi*testTIME/(24)),\n            #tanh(4*pi*testTIME/(1000)),\n            t8=tanh(4*pi*testTIME/(365*24)),\n            t9=sin(2*pi*testTIME/(24)),\n            #t10=sin(2*pi*testTIME/(1000)),\n            t11=cos(2*pi*testTIME/(24)),\n            #t12=cos(2*pi*testTIME/(1000)),\n            t13=sin(4*pi*testTIME/(356*24)),\n            t14=cos(4*pi*testTIME/(365*24)),\n            t15=sin(2*pi*testTIME/(365*24)),\n            t16=cos(2*pi*testTIME/(365*24)),\n            tt=testTIME)\n\n\nbike<-cbind(bike,\n            t1=sin(4*pi*bikeTIME/(24)),\n            t2=sin(2*pi*bike[,\"temp2\"]/(1000))*cos(2*pi*bikeTIME/(24)),\n            t3=cos(4*pi*bikeTIME/(24)),\n            #t4=cos(4*pi*bikeTIME/(1000)),\n            t5=tanh(2*pi*bikeTIME/(24)),#tanh(2*pi*bikeTIME/(1000)),\n            t6=tanh(2*pi*bikeTIME/(365*24)),\n            #t7=tanh(4*pi*bikeTIME/(24)),#tanh(4*pi*bikeTIME/(1000)),\n            t8=tanh(4*pi*bikeTIME/(365*24)),\n            t9=sin(2*pi*bikeTIME/(24)),\n            #t10=sin(2*pi*bikeTIME/(1000)),\n            t11=cos(2*pi*bikeTIME/(24)),\n            #t12=cos(2*pi*bikeTIME/(1000)),\n            t13=sin(4*pi*bikeTIME/(356*24)),\n            t14=cos(4*pi*bikeTIME/(365*24)),\n            t15=sin(2*pi*bikeTIME/(365*24)),\n            t16=cos(2*pi*bikeTIME/(365*24)),\n            tt=bikeTIME)\n\n# humid and windspeed\ntest<-cbind(test,\n            sinhumid=sin(2*pi*test[,\"humidity\"]/4),\n            coshumid=cos(2*pi*test[,\"humidity\"]/4),\n            sinhumid2=sin(2*pi*test[,\"humid2\"]/10),\n            coshumid2=cos(2*pi*test[,\"humid2\"]/10),\n            sinhumid3=sin(2*pi*test[,\"humid3\"]/(10)),\n            coshumid3=cos(2*pi*test[,\"humid3\"]/(10)),\n            sinwind=sin(2*pi*test[,\"windspeed\"]/(10)),\n            coswind=cos(2*pi*test[,\"windspeed\"]/(10)),\n            sinwind2=sin(2*pi*test[,\"windspeed2\"]/(0.00001)),\n            coswind2=cos(2*pi*test[,\"windspeed2\"]/(0.00001)),\n            sinwind3=sin(2*pi*test[,\"windspeed3\"]/(0.00001)),\n            coswind3=cos(2*pi*test[,\"windspeed3\"]/(0.00001)))\n\nbike<-cbind(bike,\n            sinhumid=sin(2*pi*bike[,\"humidity\"]/4),\n            coshumid=cos(2*pi*bike[,\"humidity\"]/4),\n            sinhumid2=sin(2*pi*bike[,\"humid2\"]/10),\n            coshumid2=cos(2*pi*bike[,\"humid2\"]/10),\n            sinhumid3=sin(2*pi*bike[,\"humid3\"]/(10)),\n            coshumid3=cos(2*pi*bike[,\"humid3\"]/(10)),\n            sinwind=sin(2*pi*bike[,\"windspeed\"]/(10)),\n            coswind=cos(2*pi*bike[,\"windspeed\"]/(10)),\n            sinwind2=sin(2*pi*bike[,\"windspeed2\"]/(0.00001)),\n            coswind2=cos(2*pi*bike[,\"windspeed2\"]/(0.00001)),\n            sinwind3=sin(2*pi*bike[,\"windspeed3\"]/(0.00001)),\n            coswind3=cos(2*pi*bike[,\"windspeed3\"]/(0.00001)))\n\n# # #temp and atemp\nbike<-cbind(bike,\n            sintemp2=sin(2*pi*bike[,\"temp2\"]/(10000)),\n            costemp2=cos(2*pi*bike[,\"temp2\"]/(10000)),\n            sintemp3=sin(2*pi*bike[,\"temp3\"]/(1000000)),\n            costemp3=cos(2*pi*bike[,\"temp3\"]/(1000000)),\n            sinatemp2=sin(2*pi*bike[,\"atemp2\"]/(10000)),\n            cosatemp2=cos(2*pi*bike[,\"atemp2\"]/(10000)),\n            sinatemp3=sin(2*pi*bike[,\"atemp3\"]/(1000000)),\n            cosatemp3=cos(2*pi*bike[,\"atemp3\"]/(1000000)))\n\n\ntest<-cbind(test,\n            sintemp2=sin(2*pi*test[,\"temp2\"]/(10000)),\n            costemp2=cos(2*pi*test[,\"temp2\"]/(10000)),\n            sintemp3=sin(2*pi*test[,\"temp3\"]/(1000000)),\n            costemp3=cos(2*pi*test[,\"temp3\"]/(1000000)),\n            sinatemp2=sin(2*pi*test[,\"atemp2\"]/(10000)),\n            cosatemp2=cos(2*pi*test[,\"atemp2\"]/(10000)),\n            sinatemp3=sin(2*pi*test[,\"atemp3\"]/(1000000)),\n            cosatemp3=cos(2*pi*test[,\"atemp3\"]/(1000000)))\n\nbike<-cbind(bike,\n            bts= bikeTIME*bike[,\"season\"],\n            btw= bikeTIME*bike[,\"weather\"],\n            btt= bikeTIME*bike[,\"temp\"]\n)\n\ntest<-cbind(test,\n            bts= testTIME*test[,\"season\"],\n            btw= testTIME*test[,\"weather\"],\n            btt= testTIME*test[,\"temp\"]\n)\n\n\n\n# bike<-cbind(bike,\n#             sqrttemp=sqrt(bike[,\"temp\"]),\n#             sqrtatemp=sqrt(bike[,\"atemp\"]),\n#             sqrthumid=sqrt(bike[,\"humidity\"]),\n#             sqrtwindspeed=sqrt(bike[,\"windspeed\"]))\n# \n# test<-cbind(test,\n#             sqrttemp=sqrt(test[,\"temp\"]),\n#             sqrtatemp=sqrt(test[,\"atemp\"]),\n#             sqrthumid=sqrt(test[,\"humidity\"]),\n#             sqrtwindspeed=sqrt(test[,\"windspeed\"]))\n\n# bike<-cbind(bike,\n#             logtemp=log(bike[,\"temp\"]))\n#loghumid=log(bike[,\"humidity\"]))\n#logwindspeed=log(bike[,\"windspeed\"]))\n\n# test<-cbind(test,\n#             logtemp=log(test[,\"temp\"]))\n\n#loghumid=log(test[,\"humidity\"]))\n#logwindspeed=log(test[,\"windspeed\"]))\n\n\n\n\n\nbike<-data.matrix(bike)\ntest<-data.matrix(test)\n",
    "created" : 1422053786804.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1688651721",
    "id" : "57B7105E",
    "lastKnownWriteTime" : 1422342358,
    "path" : "~/workspace/kaggle/bikeshare/factorengineering_v1.R",
    "project_path" : "factorengineering_v1.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}